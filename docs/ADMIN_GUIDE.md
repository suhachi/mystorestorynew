# 📘 Admin 결제 설정 가이드 (MyStoreStory)

## 1. 위치
관리자 페이지 → **"결제 설정(Payment)"** 탭

## 2. 일반 결제 설정
배달 및 포장 주문에 대해 각 결제 수단(현금, 카드, 매장 방문 결제 등)을 개별적으로 ON/OFF 할 수 있습니다.

## 3. 온라인 결제(Nicepay) 설정

### 필드 설명
| 항목 | 설명 |
| :--- | :--- |
| **온라인 결제 사용** | 이 스위치가 켜져(TRUE) 있어야만 Checkout 화면에 APP_CARD 옵션이 노출될 수 있습니다. |
| **Client Key** | NICEPAY 상점 관리자 콘솔에서 발급받은 Client Key를 입력합니다. |
| **운영 모드** | **SANDBOX**: 테스트 환경 (실제 청구 X)<br>**LIVE**: 실 서비스 환경 (실제 청구 O, LIVE 키 필수) |
| **앱 카드 결제 허용** | 고객이 Checkout에서 "앱 카드 결제"를 선택할 수 있게 할지 여부입니다. |
| **최소 결제 금액** | (선택) 이 금액 미만의 주문에서는 온라인 결제를 사용할 수 없도록 제한합니다. |

### SANDBOX / LIVE 차이
- **SANDBOX**: 개발 및 테스트용 모드입니다. 결제창이 뜨고 결제 프로세스가 진행되지만, 실제로 카드사 청구가 발생하지 않습니다.
- **LIVE**: 실제 운영 모드입니다. 실제 결제 승인이 이루어지므로 주의가 필요합니다.

## 4. Checkout 반영 규칙 (App Card Truth Table)
Checkout 화면에서 "앱 카드 결제" 옵션이 어떻게 표시되는지 결정하는 규칙입니다.

1. **완전 숨김 (HIDDEN)**
   - `온라인 결제 사용`이 꺼져 있거나, 시스템 환경변수(`VITE_USE_ONLINE_PAYMENT`)가 꺼져 있는 경우.
   
2. **설정 필요 (DISABLED_CONFIG)**
   - `온라인 결제 사용`은 켜져 있으나, `Client Key`가 없거나 `운영 모드`가 선택되지 않은 경우.
   - 목록에는 보이지만 "설정 필요" 문구와 함께 비활성화됩니다.

3. **금액 미달 (DISABLED_AMOUNT)**
   - 모든 설정이 정상이지만, 현재 주문 금액이 `최소 결제 금액`보다 적은 경우.
   - "최소 X원 이상" 문구와 함께 비활성화됩니다.

4. **정상 사용 (ENABLED)**
   - 위 모든 조건을 만족하는 경우 정상적으로 선택 가능합니다.

## 5. 저장 동작
- "결제 설정 저장" 버튼을 누르면 Firestore의 `stores/{storeId}.paymentSettings` 경로에 데이터가 업데이트됩니다.
- 페이지를 새로고침해도 저장된 설정은 그대로 유지됩니다.
