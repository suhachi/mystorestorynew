# 스테이징 배포 가이드

**작성일**: 2024년 1월 25일
**프로젝트**: MyStoreStory
**단계**: 단계 4 - 스테이징 배포

---

## 📌 목표

스테이징 환경에 프로젝트를 배포하고 테스트합니다.

---

## ⚠️ 사전 준비

### 필수 사항
1. ✅ 환경 변수 설정 (`.env.local` 파일 생성)
2. ✅ 빌드 테스트 성공 (`npm run build`)
3. ✅ Firebase CLI 설치 및 로그인
4. ✅ Firebase 프로젝트 설정 확인

---

## 🔄 스테이징 배포 단계

### 1. Firebase CLI 확인

```bash
# Firebase CLI 버전 확인
firebase --version

# Firebase 로그인 확인
firebase login:list

# 프로젝트 목록 확인
firebase projects:list
```

### 2. Firebase 프로젝트 선택

```bash
# 프로젝트 디렉토리로 이동
cd MY_STORE_STORYdesign

# Firebase 프로젝트 선택
firebase use mystorestory

# 현재 프로젝트 확인
firebase use
```

### 3. 빌드 실행

```bash
# 프로젝트 빌드
npm run build
# 또는
pnpm build

# 빌드 결과 확인
# dist/ 폴더가 생성되어야 함
```

### 4. Firestore Rules 배포

```bash
# Firestore Rules 검증 (dry-run)
firebase deploy --only firestore:rules --dry-run

# Firestore Rules 배포
firebase deploy --only firestore:rules
```

### 5. Firestore Indexes 배포

```bash
# Firestore Indexes 배포
firebase deploy --only firestore:indexes

# 주의: 인덱스 생성은 5-10분 정도 소요될 수 있습니다
```

### 6. Cloud Functions 배포

```bash
# Functions 디렉토리로 이동
cd functions

# 의존성 설치
npm install
# 또는
pnpm install

# Functions 빌드
npm run build
# 또는
pnpm build

# 루트 디렉토리로 돌아가기
cd ..

# Cloud Functions 배포
firebase deploy --only functions
```

### 7. Firebase Hosting 배포

```bash
# Firebase Hosting 배포
firebase deploy --only hosting

# 또는 전체 배포
firebase deploy
```

---

## ✅ 배포 성공 확인

### 1. 배포 결과 확인

배포가 성공하면 다음과 같은 메시지가 표시됩니다:

```
✔  Deploy complete!

Hosting URL: https://mystorestory.web.app
```

### 2. 배포된 사이트 확인

- Hosting URL 접속: https://mystorestory.web.app
- 사이트가 정상적으로 로드되는지 확인
- 주요 기능 테스트

### 3. Firebase Console 확인

- Firebase Console > Hosting에서 배포 내역 확인
- Firebase Console > Functions에서 함수 상태 확인
- Firebase Console > Firestore에서 Rules 및 Indexes 확인

---

## 🧪 스모크 테스트

### 1. 기본 기능 테스트

- [ ] 홈페이지 로드 확인
- [ ] 로그인 페이지 접근 확인
- [ ] 회원가입 페이지 접근 확인
- [ ] 주요 페이지 라우팅 확인

### 2. Firebase 연동 테스트

- [ ] Authentication 로그인 테스트
- [ ] Firestore 데이터 읽기/쓰기 테스트
- [ ] Storage 파일 업로드 테스트 (있는 경우)

### 3. 오류 확인

- [ ] 브라우저 콘솔 오류 확인
- [ ] 네트워크 오류 확인
- [ ] Firebase 오류 확인

---

## ❌ 배포 실패 시 확인 사항

### 1. Firebase CLI 오류

**증상**: `firebase: command not found`

**해결 방법**:
```bash
# Firebase CLI 설치
npm install -g firebase-tools
# 또는
pnpm add -g firebase-tools
```

### 2. 로그인 오류

**증상**: `Error: Authentication required`

**해결 방법**:
```bash
# Firebase 로그인
firebase login
```

### 3. 프로젝트 선택 오류

**증상**: `Error: No project active`

**해결 방법**:
```bash
# 프로젝트 선택
firebase use mystorestory

# 또는 프로젝트 목록에서 선택
firebase use
```

### 4. 빌드 오류

**증상**: `Error: Build failed`

**해결 방법**:
1. 빌드 로그 확인
2. 환경 변수 확인
3. 의존성 재설치
4. 빌드 오류 수정

### 5. Rules 검증 오류

**증상**: `Error: Rules validation failed`

**해결 방법**:
1. `src/firestore.rules` 파일 확인
2. Rules 문법 확인
3. Firebase Console에서 Rules 테스트

### 6. Indexes 생성 오류

**증상**: `Error: Index creation failed`

**해결 방법**:
1. `src/firestore.indexes.json` 파일 확인
2. 인덱스 정의 확인
3. Firebase Console에서 인덱스 상태 확인

---

## 📋 스테이징 배포 체크리스트

### 사전 준비
- [ ] 환경 변수 설정 완료
- [ ] 빌드 테스트 성공
- [ ] Firebase CLI 설치 및 로그인
- [ ] Firebase 프로젝트 선택

### 배포 실행
- [ ] 빌드 실행
- [ ] Firestore Rules 배포
- [ ] Firestore Indexes 배포
- [ ] Cloud Functions 배포
- [ ] Firebase Hosting 배포

### 배포 확인
- [ ] 배포 성공 메시지 확인
- [ ] Hosting URL 접속 확인
- [ ] 기본 기능 테스트
- [ ] Firebase 연동 테스트
- [ ] 오류 확인

---

## 🔄 다음 단계

스테이징 배포가 성공하고 스모크 테스트가 통과하면:

### 프로덕션 배포 준비
1. 프로덕션 환경 변수 확인
2. 프로덕션 Firebase 프로젝트 확인
3. 프로덕션 배포 실행
4. 프로덕션 스모크 테스트

---

## 📊 배포 스크립트 사용

배포 스크립트를 사용하면 더 쉽게 배포할 수 있습니다:

```bash
# 스테이징 배포
./src/scripts/deploy.sh staging

# 프로덕션 배포
./src/scripts/deploy.sh production
```

**참고**: Windows에서는 PowerShell을 사용하거나 Git Bash를 사용해야 합니다.

---

**작성일**: 2024년 1월 25일
**상태**: ✅ 스테이징 배포 가이드 작성 완료
**다음 단계**: 빌드 테스트 성공 후 스테이징 배포 실행

